__base__: "baseconfig.yaml"
log:
  name: "defaultname"
  dir: "" # default save to /output/exp
  tensorboard_log_interval: 7  # Log losses every N steps

checkpoint:
  resume: true          # 是否从断点恢复
  resume_path: "/workspace/gan_seg/outputs/exp/20251020_100829/checkpoints/step_5000.pt"
  overwrite_flow_predictor: true
  overwrite_flow_path: "/workspace/zeroflow_weights/argo/supervised/supervised.ckpt"
  save_every_iters: 1000
model:
  flow:
    name: "FastFlow3D"
    lr: 2e-6
    FastFlow3D:
      VOXEL_SIZE: [0.2, 0.2, 6]
      PSEUDO_IMAGE_DIMS: [512, 512]
      POINT_CLOUD_RANGE: [-51.2, -51.2, -3, 51.2, 51.2, 3]
      FEATURE_CHANNELS: 32
      SEQUENCE_LENGTH: 2
  mask:
    name: "PointMaskFormer"
    lr: 2e-6
    slot_num: 19

dataset:
  name: "AV2_SceneFlowZoo"
  AV2_SceneFlowZoo:
    root_dir: "/workspace/av2data/train"
    subsequence_length: 2
    sliding_window_step_size: 1
    with_ground: false
    with_rgb: false
    eval_type: "bucketed_epe"
    expected_camera_shape: (194, 256, 3)
    cache_root: "/workspace/av2data/cache"
    use_gt_flow: false
    flow_data_path: "/workspace/av2flow/train/"
    downsample_factor: 4

  val_name: "AV2_SceneFlowZoo_val"
  AV2_SceneFlowZoo_val_flow:
    root_dir: "/workspace/av2data/val"
    with_ground: false
    with_rgb: false
    eval_type: "bucketed_epe"
    expected_camera_shape: (194, 256, 3)
    use_gt_flow: true
    cache_root: "/workspace/av2data/cache"
    flow_data_path: "/workspace/av2flow/val/"
    eval_args_output_path: "eval_results/bucketed_epe/nsfp_distillation_1x/"
  AV2_SceneFlowZoo_val_mask:
    root_dir: "/workspace/av2data/val"
    with_ground: false
    with_rgb: false
    eval_type: "bucketed_epe"
    expected_camera_shape: (194, 256, 3)
    use_gt_flow: false
    cache_root: "/workspace/av2data/cache"
    flow_data_path: "/workspace/av2flow/val/"
    eval_args_output_path: "eval_results/bucketed_epe/nsfp_distillation_1x/"

lr_multi:
  rec_loss: 0.01
  flow_loss: 0.0
  scene_flow_smoothness: 0.01
  rec_flow_loss: 0.0
  point_smooth_loss: 0.01
  eular_flow_loss: 0.0
  KDTree_loss: 0
  KNN_loss: 3.0
  l1_regularization: 0.0
  eular_mask_loss: 0
  scene_flow_smoothness_scheduler:
    begin_iter: 0
    end_iter: 8000
    begin_value: 1.0
    end_value: 1.0

# alternate:
#   flow: [[50,true],[50,false]]
#   mask: [[50,false],[50,true]]
training:
  max_iter: 300000
  eval_loop: 1000
  begin_train_smooth: 0
  begin_train_mask: 0
dataloader:
  batchsize: 1
  num_workers: 0
loss:
  scene_flow_smoothness:
    scale_flow_grad: 0.001
    each_mask_item:
      relative_gradient: 0.9
      criterion: "L2"
    sum_mask_item:
      relative_gradient: 0
      criterion: "L2"


vis:
  show_window: false
  debug_grad: false

eval:
  eval_size: 300
  min_points: 200